---
title: "Properties"
description: ""
permalink: 'properties/'
eleventyNavigation:
    key: 'Properties' 
    order: '200'
---

{% extends "layouts/base_nofooter.html" %}

{% block head %}
  <link rel="stylesheet" href="/assets/css/cms-menu.css">
  <script src="../Vector-Tiles-Google-Maps/dist/vector-tiles-google-maps.js"></script>


  <style>
    #container {
      display: flex;
      height: 100vh;
      /*margin-top: var(--nav-height, 0); /* in case you're dynamically adjusting */
    }
  
    #listing-view {
      width: 50%;
      overflow-y: auto;
      padding: 10px;
      box-sizing: border-box;
      background-color: #f9f9f9;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 15px;
    }

  
    #map {
      width: 50%;
      height: 100%;
    }
  
    .listing-card {
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      overflow: visible;
      /* Remove height: 100% or add a max-height */
      /*max-height: 500px; /* Or whatever looks good on mobile */
      transition: box-shadow 0.2s ease, transform 0.1s ease;
      cursor: pointer;
      max-height: 19em;
    }
    @media (max-width: 1200px) {
    .listing-card {
      margin-bottom: 1rem;
    }
  }
    
    .listing-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      transform: translateY(-2px);
    }


    .listing-card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-bottom: 1px solid #eee;
      position: relative;
      border-top-left-radius: 6px;
      border-top-right-radius: 6px;
    }

    .listing-info {
      padding: 12px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

  
    .listing-title {
      font-weight: bold;
      font-size: 16px;
    }
  
    .listing-sub {
      font-size: 14px;
      color: #666;
    }



    #container.layout {
  display: flex;
  height: 100vh;
}

#listing-view {
  overflow-y: auto;
  padding: 10px;
  background: #f9f9f9;
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 15px;
  width: 35%;
}
#leftcontainer {
  width: 35%;
  display: flex;
  flex-direction: column;
}

#map-container {
  position: relative;
  width: 65%;
}

#map {
  width: 100%;
  height: 100%;
}


/* Mobile: Only one view at a time */
@media (max-width: 1200px) {
  #leftcontainer {
    width: 100%;
    height: calc(100vh - 80px); /* Adjust if you have nav */
  }

}
@media (max-width: 1200px) {
  #container.layout {
    flex-direction: column;
  }

  #listing-view,
  #map-container {
    width: 100%;
    height: calc(100vh - 80px); /* Adjust if you have nav */
    display: none;
  }

  #container.layout.show-list #listing-view {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  #container.layout.show-map #map-container {
    display: block;
  }
}

#toggle-view {
  display: none;
}

@media (max-width: 1200px) {
  #toggle-view {
    display: block;
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: #003f7d;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    cursor: pointer;
    z-index: 10000;
  }
}

/* Mobile: Only one view at a time */
@media (max-width: 768px) {
  #container.layout {
    flex-direction: column;
  }

  #listing-view,
  #map-container {
    width: 100%;
    height: calc(100vh - 80px); /* Adjust if you have nav */
    display: none;
  }

  #container.layout.show-list #listing-view {
    display: block;
    grid-template-columns: 1fr; /* 1 column on mobile */
  }

  #container.layout.show-map #map-container {
    display: block;
  }
}

/* #toggle-view {
  display: none;
} */

@media (max-width: 768px) {
  #toggle-view {
    display: block;
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: #003f7d;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    cursor: pointer;
    z-index: 10000;
  }
}

/* @media (min-width: 769px) {
  #toggle-view {
    display: none !important;
  }
} */

.image-wrapper {
  position: relative;
}

.status-badge {
  position: absolute;
  top: 8px;
  left: 8px;
  background-color: #003f7d;
  color: white;
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 4px;
  z-index: 10;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-badge.sale { background-color: #e63946; }
.status-badge.lease { background-color: #0077b6; }
.status-badge.closed { background-color: #6c757d; }
.status-badge.under_contract {
  background-color: #6c757d; /* Same as closed */
}



#sort-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 15px;
  background: white;
  border-bottom: 1px solid #ddd;
  font-size: 14px;
  z-index: 1000;
}

#sort-bar #results-count {
  color: #333;
}

#sort-bar .dropdown {
  position: relative;
}

.dropdown-toggle {
  background: white;
  border: 1px solid #ccc;
  padding: 6px 10px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.dropdown-menu {
  position: absolute;
  top: 110%;
  right: 0;
  background: white;
  border: 1px solid #ccc;
  border-radius: 4px;
  list-style: none;
  padding: 8px 0;
  margin: 0;
  width: 220px;
  display: none;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  z-index: 1001;
}

.dropdown-menu li {
  padding: 8px 15px;
  cursor: pointer;
  font-size: 14px;
}

.dropdown-menu li:hover {
  background-color: #f0f0f0;
}
#filter-bar-inline {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  align-items: center;
  justify-content: flex-start;
  padding: 16px 24px;
  background: white;
  border-bottom: 1px solid #ddd;
  width: 100%;
  z-index: 15;
  position: relative;
  /*margin-top: 110px; /* <- adjust this to match your header height */
}


#filter-bar-inline input[type="text"],
#filter-bar-inline select {
  padding: 8px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 3px;
  /* width: 180px; */
  width: fit-content;
}

.filter-group {
  position: relative;
}

.multi-select {
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 3px;
  background-color: #fff;
  cursor: pointer;
  width: 180px;
}

.multi-options {
  position: absolute;
  top: 100%;
  left: 0;
  z-index: 1000;
  background: #fff;
  border: 1px solid #ccc;
  width: 180px;
  max-height: 200px;
  overflow-y: auto;
  display: none;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.filter-group:hover .multi-options {
  display: block;
  z-index: 15;
}

.multi-options label {
  display: block;
  padding: 5px 10px;
  font-size: 14px;
}

.btn {
  background-color: #002c54;
  color: white;
  border: none;
  border-radius: 3px;
  padding: 8px 16px;
  cursor: pointer;
}

.btn:hover {
  opacity: 0.9;
}


.hover-details {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  background-color: white;
  color: #333;
  padding: 12px;
  font-size: 13px;
  line-height: 1.4;
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease;
  border-bottom-left-radius: 6px;
  border-bottom-right-radius: 6px;
  z-index: 5;
}

.listing-card {
  position: relative;
  transition: all 0.3s ease;
}

.listing-card:hover {
  background: white;
}

.listing-card:hover .hover-details {
  opacity: 1;
  visibility: visible;
}

  </style>
  
{% endblock %}

{% block body %}
<div id="filter-bar-inline">
  <input type="text" id="search-input" placeholder="Search by address, city, state, or zip">


  <div class="filter-group hide-mobile">
    <div tabindex="0" class="multi-select">Property Types ▼</div>
    <div class="multi-options">
      <label><input type="checkbox" value="all" checked> Select All</label>
      <label><input type="checkbox" value="industrial"> Industrial</label>
      <label><input type="checkbox" value="land"> Land</label>
      <label><input type="checkbox" value="medical"> Medical</label>
      <label><input type="checkbox" value="office"> Office</label>
      <label><input type="checkbox" value="retail"> Retail</label>
      <label><input type="checkbox" value="special purpose"> Special Purpose</label>
      <label><input type="checkbox" value="residential"> Residential</label>
      <label><input type="checkbox" value="flex"> Flex</label>
    </div>
  </div>
  

  <select id="listing-type-filter">
    <option value="sale-or-lease" selected>Sale/Lease</option>
    <option value="sale">Sale</option>
    <option value="lease">Lease</option>
    <option value="under_contract">Under Contract</option>
    <option value="closed">Closed</option>
    <option value="all">All</option>
  </select>
  
  

  <input type="text" id="min-sf" class="hide-mobile" placeholder="Min SF">
  <input type="text" id="max-sf" class="hide-mobile" placeholder="Max SF">


  <!-- <button class="btn">More Filters</button>
  <button class="btn btn-secondary">Reset Filters</button> -->
  <button id="reset-filters" class="btn hide-mobile" style="background-color: #999;">Reset Filters</button>

</div>
<div id="container" class="layout show-list">

  <div id="map-container">
    <div id="map" style="width: 100%; height: 100%;"></div>
  </div>
  <div id="leftcontainer">
    {% set total = listings.listings.length %}
  <div id="results-count-wrapper" style="padding: 5px 16px; font-size: 14px;">
    <p>
      <span id="results-count-text">
        1 - {% if total > 30 %}30{% else %}{{ total }}{% endif %} results out of {{ total }} listings
      </span>
    </p>
  </div>
  <div id="listing-view" style="width: 100%;">
    {% for listing in groupedListings %}

    <script>
      
      
      // console.log("{{ listing.address }}")
      {% if listing.address == "2845 Broce Drive Norman, OK 73072" %}
      console.log("{{ listing.address }}")
      console.log("{{ listing.gallery.length }}");
      console.log("{{ listing.property_types.length }}");
      {% for prop_type in listing.property_types %}
        console.log("{{ prop_type }}")
      {% endfor %}
      {% endif %}

      </script>

    {% if not listing.gallery[0] %}
    {% else %}


    {% set total_sf = 0 %}
      {% set square_feet = "" %}
      {% if listing.detailsTable and listing.detailsTable.fields %}
        {% for field in listing.detailsTable.fields %}
          {% if field.id == "square_feet" %}
            {% set square_feet = field.value %}
            {% set total_sf = field.value | replace(",", "") | int %}
          {% endif %}
        {% endfor %}
      {% endif %}
    <div class="listing-card"
     href="/properties/{{ listing.slug | slugify }}"
     data-lat="{{ listing.location.lat }}"
     data-lng="{{ listing.location.lng }}"
     data-type="{{ listing.listing_type }}"
     data-sf="{{ total_sf }}"
     data-property="{{ listing.property_types | join(',') | lower }}"
     onclick="window.location.href='/properties/{{ listing.slug | slugify }}'">

      <div class="image-wrapper">
        <img src="{{ listing.gallery[0].url }}?h=300&fit=max&auto=format&q=75" alt="{{ listing.address }}">
        <div class="status-badge {{ listing.listing_type }}">
          {% if listing.listing_type == "both" %}
            For Sale/Lease
          {% elif listing.listing_type == "under_contract" %}
            Pending
          {% else %}
            {{ listing.listing_type | capitalize }}
          {% endif %}
        </div>
        
      </div>
      <div class="listing-info">
        <div class="listing-title">{{ listing.address }}</div>
        <div class="listing-sub">
          {% set price_info = "" %}
            {% if listing.detailsTable and listing.detailsTable.fields %}
              <script>
              console.log("---------------------------------")
              console.log("{{ listing.address }}")
              </script>
              {% for field in listing.detailsTable.fields %}
              <script>
              // console.log("---")
              // console.log("{{ field.id }}")
              // console.log("{{ field.value }}")
              // console.log("---")
              </script>
                {% if field.id == "sale_price" and listing.listing_type == "sale" %}
                  {% set price_info = field.value %}
                {% elif field.id == "lease_rate" and listing.listing_type == "lease" %}
                  {% set price_info = field.value %}
                {% elif field.id == "sale_price" and listing.listing_type == "under_contract" %}
                  {% set price_info = field.value %}
                {% elif field.id == "lease_rate" and listing.listing_type == "under_contract" %}
                  {% set price_info = field.value %}
                {% elif field.id == "sale_price" and listing.listing_type == "closed" %}
                  {% set price_info = field.value %}
                {% elif field.id == "lease_rate" and listing.listing_type == "closed" %}
                  {% set price_info = field.value %}
                {% endif %}
              {% endfor %}
              {% endif %}
              {{ price_info }}
        </div>
      </div>
      <div class="hover-details">
        
        {% set price_info_hover = "" %}
        {% set price_title_hover = "" %}
        



        {% set square_feet = "" %}
        {% set lot_size = "" %}
        {% set year_built = "" %}
          
        {% set square_feet_title = "" %}
        {% set lot_size_title = "" %}
        {% set year_built_title = "" %}
          
          {% if listing.detailsTable and listing.detailsTable.fields %}
            {% for field in listing.detailsTable.fields %}

              {% if field.id == "sale_price" and listing.listing_type == "sale" %}
              {% set price_info_hover = field.value %}
              {% set price_title_hover = field.displayName %}
            {% elif field.id == "lease_rate" and listing.listing_type == "lease" %}
              {% set price_info_hover = field.value %}
              {% set price_title_hover = field.displayName %}
            {% elif field.id == "sale_price" and listing.listing_type == "under_contract" %}
              {% set price_info_hover = field.value %}
              {% set price_title_hover = field.displayName %}
            {% elif field.id == "lease_rate" and listing.listing_type == "under_contract" %}
              {% set price_info_hover = field.value %}
              {% set price_title_hover = field.displayName %}
            {% elif field.id == "sale_price" and listing.listing_type == "closed" %}
              {% set price_info_hover = field.value %}
              {% set price_title_hover = field.displayName %}
            {% elif field.id == "lease_rate" and listing.listing_type == "closed" %}
              {% set price_info_hover = field.value %}
              {% set price_title_hover = field.displayName %}
            {% endif %}



              {% if field.id == "square_feet" %}
                {% set square_feet_title = field.displayName %}
                {% set square_feet = field.value %}

              {% elif field.id == "lot_size" %}
                {% set lot_size_title = field.displayName %}
                {% set lot_size = field.value %}
              {% elif field.id == "year_built" %}
                {% set year_built_title = field.displayName %}
                {% set year_built = field.value %}
              {% endif %}
            {% endfor %}
          {% endif %}
          
          {% if price_info_hover %}<div><strong>{{ price_title_hover }}:</strong> {{ price_info_hover }}</div>{% endif %}
          <div><strong>Address:</strong> {{ listing.address }}</div>
          {% if square_feet %}<div><strong>{{ square_feet_title }}:</strong> {{ square_feet }}</div>{% endif %}
          {% if lot_size %}<div><strong>{{ lot_size_title }} :</strong> {{ lot_size }}</div>{% endif %}
          {% if year_built %}<div><strong>{{ year_built_title }}:</strong> {{ year_built }}</div>{% endif %}
      </div>
    </div>
    
    {% endif %}
    {% endfor %}
  </div>
  </div>
  <button id="toggle-view" onclick="toggleView()">Show Map</button>
</div>


<script>
  // let markers = [];
  // let allMarkers = [];
  // let openInfoWindow = null; // Track the currently open info window

  // window.initMap = function () {
  //   const center = { lat: 35.2216, lng: -97.4446 };
  //   map = new google.maps.Map(document.getElementById("map"), {
  //     zoom: 9,
  //     tilt: 0,
  //     center: center,
  //     mapTypeControl: true,
  //     mapTypeControlOptions: {
  //       style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
  //       position: google.maps.ControlPosition.TOP_LEFT,
  //     },
  //     mapTypeId: google.maps.MapTypeId.ROADMAP,
  //     options: {
  //       minZoom: 5,
  //       maxZoom: 19,
  //       gestureHandling: 'greedy'
  //     }
  //   });
  //   map.addListener("zoom_changed", function (event) {
  //   if (map.getZoom() >= 15) {
  //     logVisibleCounties()
  //   }
  // });

  
    {% for listing in groupedListings %}
    {% if not listing.gallery[0] %}
    {% else %}
    
  (function() {
    const lat = {{ listing.location.lat or 0 }};
    const lng = {{ listing.location.lng or 0 }};

    console.log({{ listing.location.lat or 0 }}, {{ listing.location.lat or 0 }},  "{{ listing.address | escape }}");
    const title = "{{ listing.address | escape }}";
    {% set price = "" %}
    {% set square_feet = "" %}
    {% set square_feet_title = "" %}
    {% set lot_size = "" %}
    
    {% if listing.detailsTable and listing.detailsTable.fields %}
      {% for field in listing.detailsTable.fields %}
        {% if field.id == "sale_price" and listing.listing_type == "sale" %}
          {% set price = field.value %}
        {% elif field.id == "lease_rate" and listing.listing_type == "lease" %}
          {% set price = field.value %}
        {% elif field.id == "sale_price" and listing.listing_type == "under_contract" %}
          {% set price = field.value %}
        {% elif field.id == "lease_rate" and listing.listing_type == "under_contract" %}
          {% set price = field.value %}
        {% elif field.id == "sale_price" and listing.listing_type == "closed" %}
          {% set price = field.value %}
        {% elif field.id == "lease_rate" and listing.listing_type == "closed" %}
          {% set price = field.value %}
        {% elif field.id == "square_feet" %}
          {% set square_feet_title = field.displayName %}
          {% set square_feet = field.value %}
        {% elif field.id == "lot_size" %}
          {% set lot_size = field.value %}
        {% endif %}
      {% endfor %}
    {% endif %}
    const price = "{{ price }}";
    const squareFeet = "{{ square_feet }}";
    const lotSize = "{{ lot_size }}";
    const statusRaw = "{{ listing.listing_type }}";
    // const price = {% if listing.price.sale_price %}"{{ listing.price.sale_price }}"{% elif listing.price.lease_rate %}"{{ listing.price.lease_rate }}"{% else %}"N/A"{% endif %};
    // const squareFeet = {% if listing.buildings[0].square_feet %}"{{ listing.buildings[0].square_feet}}"{% else %}''{% endif %};
    // const lotSize = {% if listing.buildings[0].lot_size %}"{{ listing.buildings[0].lot_size}}"{% else %}''{% endif %};
    // const statusRaw = "{{ listing.listing_type }}";
    const status = 
      statusRaw === "both" ? "For Sale/Lease" :
      statusRaw === "under_contract" ? "Pending" :
      statusRaw.charAt(0).toUpperCase() + statusRaw.slice(1);

    const address = "{{ listing.address | escape }}";
    const agentName = "{{ listing.agent_name | escape }}";
    const agentUrl = "/properties/{{ listing.slug | slugify }}";

    const contentString = `
      <div style="max-width: 280px; font-family: sans-serif; position: relative;">
        <div style="position: relative;">
          <img src="{{ listing.gallery[0].url }}?h=300&fit=max&auto=format&q=75" alt="${title}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 4px;" loading="lazy">
          <div style="
            position: absolute;
            top: 8px;
            left: 8px;
            background-color: ${
              status === "Lease" ? "#0077b6" :
              status === "Closed" ? "#6c757d" :
              status === "Sale" ? "#e63946" :
              status === "For Sale/Lease" ? "#003f7d" :
              status === "Pending" ? "#6c757d" : "#000"
            };

            color: white;
            padding: 2px 6px;
            font-size: 12px;
            border-radius: 3px;
          ">
            ${status}
          </div>
        </div>
        <div style="padding: 10px;">
          <div style="font-size: 16px; font-weight: bold; margin-bottom: 4px;">${price}</div>
          <div style="font-size: 14px; color: #444;">${squareFeet}</div>
          <div style="font-size: 14px; color: #444;">${lotSize}</div>
          <div style="margin-top: 6px; font-size: 13px; color: #333;">${address}</div>
          <div style="margin-top: 8px; font-size: 12px;">
            <a href="${agentUrl}" target="_blank" style="color: #0074cc; text-decoration: none;">JOHNSON COMMERCIAL GROUP, ${agentName}</a>
          </div>
        </div>
        <button onclick="this.closest('.gm-style-iw').parentNode.style.display='none'" style="
          position: absolute;
          top: 6px;
          right: 6px;
          background: rgba(0,0,0,0.5);
          border: none;
          color: white;
          font-size: 14px;
          padding: 2px 6px;
          border-radius: 3px;
          cursor: pointer;
          z-index: 9999;">✕</button>
      </div>
    `;

    const marker = new google.maps.Marker({
      position: { lat, lng },
      map,
      title,
      icon: {
        url:
          status === "Sale"
            ? "/assets/images/pins/pin-red.svg"
            : status === "Lease"
            ? "/assets/images/pins/pin-blue.svg"
            : status === "Pending" || status === "Closed"
            ? "/assets/images/pins/pin-black.svg"
            : "/assets/images/pins/pin-black.svg",
        scaledSize: new google.maps.Size(40, 40),
      },

    });

    const infowindow = new google.maps.InfoWindow({ content: contentString });
    marker.set("infoContent", contentString);


    marker.addListener("click", () => {
      if (openInfoWindow) openInfoWindow.close();
      infowindow.open(map, marker);
      google.maps.event.addListenerOnce(infowindow, 'domready', function () {
        const closeBtn = document.querySelector('.gm-ui-hover-effect');
        if (closeBtn) closeBtn.style.display = 'none';
      });
      openInfoWindow = infowindow;
    });

    marker.__lat = lat;
    marker.__lng = lng;
    allMarkers.push(marker);
  })();
  {% endif %}
{% endfor %}


  }
  </script>

    <script defer>
      window.onload = function () {
        const nav = document.getElementById("cs-navigation");
        const map2 = document.getElementById("map");
        
        if (nav && map2) {
          const navHeight = nav.offsetHeight;
          map2.style.height = (window.innerHeight - navHeight) + "px";
          map2.style.marginTop = navHeight + "px";
        }
      };
    </script>
    <script defer>
      function adjustMapSize() {
        const nav = document.getElementById("cs-navigation");
        const container = document.getElementById("container");
        const map2 = document.getElementById("map");
        const map_container = document.getElementById("map-container");
        const listing = document.getElementById("listing-view");
        const filter = document.getElementById("filter-bar-inline");
        const results = document.getElementById("results-count-wrapper");
    
        if (nav && container) {
          const navHeight = nav.offsetHeight;
          const filterHeight = filter.offsetHeight;
          container.style.height = (window.innerHeight -navHeight - filterHeight) + "px";
          // map.style.marginTop = navHeight + "px";
        }
        if (nav && map_container) {
          const navHeight = nav.offsetHeight;
          const filterHeight = filter.offsetHeight;
          map_container.style.height = (window.innerHeight -navHeight - filterHeight) + "px";
          // map.style.marginTop = navHeight + "px";
        }
        if (nav && map2) {
          const navHeight = nav.offsetHeight;
          const filterHeight = filter.offsetHeight;
          map2.style.height = (window.innerHeight -navHeight - filterHeight) + "px";
          // map.style.marginTop = navHeight + "px";
        }
        if (nav && listing) {
          const navHeight = nav.offsetHeight;
          const filterHeight = filter.offsetHeight;
          const resultHeight = results.offsetHeight;
          listing.style.height = (window.innerHeight -navHeight - filterHeight - resultHeight) + "px";
          // listing.style.marginTop = navHeight + "px";
        }
        if (nav && filter) {
          const navHeight = nav.offsetHeight;
          // filter.style.height = (window.innerHeight - navHeight) + "px";
          filter.style.marginTop = navHeight + "px";
        }
      }
    
      window.onload = adjustMapSize;
    
      // Debounce for resize
      let resizeTimeout;
      window.onresize = function () {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(adjustMapSize, 50); // wait 150ms after resize ends
        console.log("resizeing!~")
      };
    </script>




<script defer>
  function toggleView() {
    
    const container = document.getElementById("container");
    const button = document.getElementById("toggle-view");

    if (container.classList.contains("show-list")) {
      container.classList.remove("show-list");
      container.classList.add("show-map");
      button.textContent = "Show List";
      window.dispatchEvent(new Event('resize'));
    } else {
      container.classList.remove("show-map");
      container.classList.add("show-list");
      button.textContent = "Show Map";
      
    }
    
    
  }

  // Optional: Ensure correct initial text when loading mobile
  window.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById("container");
    const button = document.getElementById("toggle-view");
    if (window.innerWidth <= 768) {
      if (container.classList.contains("show-list")) {
        button.textContent = "Show Map";
      } else {
        button.textContent = "Show List";
      }
    }
  });
</script>



<script defer>
  document.addEventListener('DOMContentLoaded', function () {
    const toggle = document.querySelector('.dropdown-toggle');
    const menu = document.querySelector('.dropdown-menu');

    toggle.addEventListener('click', function (e) {
      e.stopPropagation();
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    });

    document.addEventListener('click', function () {
      menu.style.display = 'none';
    });

    const sortOptions = document.querySelectorAll('.dropdown-menu li');
    sortOptions.forEach(item => {
      item.addEventListener('click', function () {
        const sortType = this.getAttribute('data-sort');
        toggle.textContent = `Sort: ${this.textContent} ▾`;
        menu.style.display = 'none';
        // You can hook into your sorting logic here later
        console.log('Selected sort:', sortType);
      });
    });
  });

</script>

<script defer>
  const searchInput = document.getElementById("search-input");
  const listingTypeSelect = document.getElementById("listing-type-filter");
  const minSFInput = document.getElementById("min-sf");
  const maxSFInput = document.getElementById("max-sf");
  const propertyCheckboxes = document.querySelectorAll('.multi-options input[type="checkbox"]');

  // === Global Filter State ===
  const filterState = {
    searchQuery: "",
    propertyTypes: new Set([...propertyCheckboxes]
      .filter(cb => cb.value !== "sale-or-lease")
      .map(cb => cb.value)),
    listingType: "sale-or-lease",
    minSF: 0,
    maxSF: Infinity
  };

  // === Core Filter Logic ===
  function applyCombinedFilters() {
    const cards = document.querySelectorAll(".listing-card");
    let visibleMarkers = [];
    const totalListings = cards.length;
    let visibleCount = 0;

    cards.forEach(card => {
      const prop = (card.dataset.property || "").toLowerCase();
      const type = (card.dataset.type || "").toLowerCase();
      const sf = parseInt(card.dataset.sf) || 0;
      const addressText = card.querySelector(".listing-title").textContent.trim();
      const normalizedAddress = addressText.toLowerCase().replace(/\s+/g, '');

      const matchesSearch = normalizedAddress.includes(filterState.searchQuery);
      const matchesType =
  filterState.listingType === "all" ||
  type === filterState.listingType ||
  (filterState.listingType === "sale-or-lease" && (type === "sale" || type === "lease" || type === "under_contract"));


      // const matchesProperty = filterState.propertyTypes.has(prop);
      const props = (card.dataset.property || "").split(',').map(p => p.trim().toLowerCase());

const matchesProperty = filterState.propertyTypes.has("all") || props.some(p => filterState.propertyTypes.has(p));


      const matchesSF = sf >= filterState.minSF && sf <= filterState.maxSF;

      const show = matchesSearch && matchesType && matchesProperty && matchesSF;

      card.style.display = show ? "flex" : "none";
      if (show) visibleCount++;

      const lat = parseFloat(card.dataset.lat);
      const lng = parseFloat(card.dataset.lng);
      allMarkers.forEach(marker => {
        if (marker.__lat === lat && marker.__lng === lng) {
          marker.setMap(show ? map : null);
          if (show) visibleMarkers.push(marker);
        }
      });

      // Highlight match in address
      if (matchesSearch && show) {
        const regex = new RegExp(`(${filterState.searchQuery})`, 'ig');
        const highlighted = addressText.replace(regex, `<span style="color:black;">$1</span>`);
        card.querySelector(".listing-title").innerHTML = highlighted;
      } else {
        card.querySelector(".listing-title").textContent = addressText;
      }
    });

    document.getElementById("results-count-text").textContent = `${visibleCount} result${visibleCount === 1 ? '' : 's'} out of ${totalListings} listings`;

    if (visibleMarkers.length > 0) {
      const bounds = new google.maps.LatLngBounds();
      visibleMarkers.forEach(m => bounds.extend(m.getPosition()));
      map.fitBounds(bounds);
    }
  }

  // === Event Listeners ===

  // Search Input
  searchInput.addEventListener("input", function () {
    filterState.searchQuery = this.value.trim().toLowerCase().replace(/\s+/g, '');
    applyCombinedFilters();
  });

  // Listing Type Dropdown
  listingTypeSelect.addEventListener("change", function () {
    filterState.listingType = this.value.toLowerCase();
    applyCombinedFilters();
  });

  // Square Footage Inputs
  function updateSFRange() {
    filterState.minSF = parseInt(minSFInput.value) || 0;
    filterState.maxSF = parseInt(maxSFInput.value) || Infinity;
    applyCombinedFilters();
  }

  minSFInput.addEventListener("input", updateSFRange);
  maxSFInput.addEventListener("input", updateSFRange);

  // Property Type Checkboxes
  propertyCheckboxes.forEach(cb => {
    cb.addEventListener("change", () => {
      const isAll = cb.value === "all";
      const selectAllBox = document.querySelector('input[value="all"]');

      if (isAll) {
        // "Select All" clicked
        filterState.propertyTypes.clear();
        propertyCheckboxes.forEach(other => {
          other.checked = true;
          // if (other.value !== 'all') 
          filterState.propertyTypes.add(other.value);
        });
      } else {
        if (selectAllBox.checked) {
          // Deselect "All" and go into custom mode
          selectAllBox.checked = false;
          filterState.propertyTypes.clear();
          propertyCheckboxes.forEach(other => {
            if (other.value !== "all") other.checked = false;
          });
          cb.checked = true;
          filterState.propertyTypes.add(cb.value);
        } else {
          if (cb.checked) {
            filterState.propertyTypes.add(cb.value);
          } else {
            filterState.propertyTypes.delete(cb.value);
          }

          // If all unchecked, re-enable Select All
          if (filterState.propertyTypes.size === 0) {
            selectAllBox.checked = true;
            propertyCheckboxes.forEach(other => {
              if (other.value !== 'all') {
                other.checked = true;
                filterState.propertyTypes.add(other.value);
              }
            });
          }
        }
      }

      applyCombinedFilters();
    });
  });


  // Reset Button
document.getElementById("reset-filters").addEventListener("click", () => {
  // Reset search
  searchInput.value = "";
  filterState.searchQuery = "";

  // Reset property types
  filterState.propertyTypes.clear();
  propertyCheckboxes.forEach(cb => {
    cb.checked = true;
    if (cb.value !== "all") filterState.propertyTypes.add(cb.value);
  });
  document.querySelector('input[value="all"]').checked = true;

  // Reset listing type
  listingTypeSelect.value = "all";
  filterState.listingType = "all";

  // Reset square footage
  minSFInput.value = "";
  maxSFInput.value = "";
  filterState.minSF = 0;
  filterState.maxSF = Infinity;

  applyCombinedFilters();
});

</script>

<script>
  function addCommasToFloat(number) {
    if (isNaN(parseFloat(number))){
      return 'N/A'
    }
    else{
      return parseFloat(number).toLocaleString('en-US');
    }

  }
  
  function formatToUSDollars(amount) {
    return amount.toLocaleString('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    });
  }
  </script>




<!-- hover markers -->

<script defer>
  document.addEventListener("DOMContentLoaded", function () {
    const cards = document.querySelectorAll(".listing-card");
  
    cards.forEach(card => {
      const lat = parseFloat(card.dataset.lat);
      const lng = parseFloat(card.dataset.lng);
  
      card.addEventListener("mouseenter", () => {
        const marker = allMarkers.find(m => m.__lat === lat && m.__lng === lng);
        if (marker) {
          if (openInfoWindow) openInfoWindow.close();
  
          // Create a dummy InfoWindow to simulate hover popup
          const infoContent = marker.get("infoContent");
          const infoWindow = new google.maps.InfoWindow({ content: infoContent });
          google.maps.event.addListenerOnce(infoWindow, 'domready', function () {
          const closeBtn = document.querySelector('.gm-ui-hover-effect');
          if (closeBtn) closeBtn.style.display = 'none';
          });
          infoWindow.open(map, marker);
          openInfoWindow = infoWindow;
          map.panTo(marker.getPosition());
        }
      });
  
      card.addEventListener("mouseleave", () => {
        if (openInfoWindow) {
          openInfoWindow.close();
          openInfoWindow = null;
        }
      });
    });
  });
  </script>
  










<style>
  #search-input{
  width: 250px !important;
}
      @media (max-width: 768px) {
  #filter-bar-inline {
    flex-direction: column;
    align-items: stretch;
    padding: 12px;
    gap: 10px;
  }

  #filter-bar-inline input[type="text"],
  #filter-bar-inline select {
    width: 100%;
  }

  .multi-select {
    width: 100%;
  }

  .multi-options {
    width: 100%;
  }

  #reset-filters {
    width: 100%;
    text-align: center;
  }
  .hide-mobile {
    display: none;
  }
}
</style>


  <!-- Google JS -->
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBiPPcrLJoFtiGbasMMqz6Akd9gE6UUWtQ&callback=initMap&loading=async"
  >
  </script>   
  
  <script async defer >
    window.addEventListener("load", (event) => {
      applyCombinedFilters()
});
  </script>
  <script defer src="/assets/js/classes.js"></script>
  <script defer src="/assets/js/property_explorer.js"></script>
{% endblock %}
